<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>系统监控</title>
  <style>
    :root{
      --bg: #0b0f14;
      --card: #121823;
      --muted: #7c8aa0;
      --text: #e8eef7;
      --accent: #29b6f6;
      --accent2:#ff6e40;
      --accent3:#8bc34a;
      --good: #7dd87d;
      --warn: #ffcc00;
      --bad:  #ff5a5f;
      --grid: rgba(255,255,255,.06);
      --chip: #1a2332;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, PingFang SC, Noto Sans CJK, Helvetica, Arial, "Microsoft Yahei", sans-serif;
      background: radial-gradient(1200px 800px at 50% -10%, #132033, var(--bg));
      color:var(--text);
    }
    .app{
      min-width: min(720px, 70vw);
      min-height: 100vh;
      margin: 0 auto;
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--accent) transparent;
    }
    .app::-webkit-scrollbar{width:10px}
    .app::-webkit-scrollbar-track{background:rgba(255,255,255,.04); border-radius:999px}
    .app::-webkit-scrollbar-thumb{
      background:linear-gradient(180deg, var(--accent), #1f9ad6);
      border-radius:999px;
      border:1px solid var(--grid);
    }
    .app::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg, #29c3ff, #1c8fc7)}
    header{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 12px; background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--grid); border-radius:14px;
      backdrop-filter: blur(6px);
    }
    .title{font-weight:600; letter-spacing:.2px}
    .subtitle{color:var(--muted); font-size:12px}
    .content{
      flex:1;
      display:flex;
      gap:18px;
      min-height:0;
    }
    .grid{
      flex:1;
      display:grid;
      gap:18px;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      grid-auto-rows:auto;
      align-content:start;
    }
    .card{
      background: var(--card);
      border:1px solid var(--grid);
      border-radius:16px;
      padding:18px;
      display:flex; flex-direction:column; gap:14px;
      box-shadow: 0 6px 24px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.03);
      /* height:260px; */
      position:relative;
      overflow:hidden;
    }
    .card-content{
      display:flex;
      flex-direction:column;
      gap:12px;
      flex:1 0 auto;
    }
    .card-content{
      display:flex;
      flex-direction:column;
      gap:12px;
      flex:1 0 auto;
    }
    .card-content{
      display:flex;
      flex-direction:column;
      gap:12px;
      flex:1 0 auto;
    }
    .card.span-2{grid-column: span 2}
    .row{display:flex; align-items:center; gap:10px; flex-wrap:nowrap}
    .grow{flex:1}
    .label{color:var(--muted); font-size:12px}
    .value{font-weight:700; font-size:22px}
    .unit{opacity:.8; font-size:12px}
    .mono{font-variant-numeric: tabular-nums; font-feature-settings: "tnum" 1}
    .chip{display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:10px; background:var(--chip); color:#cbd8ea; font-size:12px; border:1px solid var(--grid)}
    .chip.small{font-size:11px; padding:3px 6px}
    .chip-row{display:flex; flex-wrap:wrap; gap:8px}
    .chip-label{opacity:.72; letter-spacing:.2px; font-size:11px}
    .chip-value{font-weight:600}
    .chip.small .chip-value{font-size:12px}
    .chip.good{background:rgba(125,216,125,.16); border-color:rgba(125,216,125,.45); color:var(--good)}
    .chip.warn{background:rgba(255,204,0,.16); border-color:rgba(255,204,0,.45); color:var(--warn)}
    .chip.bad{background:rgba(255,90,95,.16); border-color:rgba(255,90,95,.45); color:var(--bad)}

    .ring{ --p:0; --col: var(--accent);
      width:72px; height:72px; border-radius:50%; position:relative;
      background: conic-gradient(var(--col) calc(var(--p)*1%), rgba(255,255,255,.06) 0);
      display:grid; place-items:center;
      flex-shrink:0;
    }
    .ring::before{content:""; position:absolute; inset:6px; background:var(--card); border-radius:50%}
    .ring span{ position:relative; font-weight:800; font-size:16px }

    .meter{height:10px; background:linear-gradient(180deg,#0c141f,#0a111a); border:1px solid var(--grid); border-radius:999px; overflow:hidden}
    .meter>i{display:block; height:100%; width:40%; background:linear-gradient(90deg,var(--accent),#42a5f5);}

    .kv{display:grid; grid-template-columns:auto 1fr auto; gap:6px 10px; align-items:center; font-size:13px}
    .divider{height:1px; background:var(--grid); margin:4px 0}

    canvas.spark{ width:100%; height:56px; background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02)); border-radius:12px; border:1px solid var(--grid); margin-top:auto; display:block; flex:0 0 auto}

    footer{display:flex; justify-content:space-between; align-items:center; color:var(--muted); font-size:12px}

    /* .alerts-panel{
      width: clamp(240px, 28vw, 320px);
      display:flex;
      flex-direction:column;
      gap:14px;
    } */
    .panel-card{
      background: var(--card);
      border:1px solid var(--grid);
      border-radius:16px;
      padding:16px;
      box-shadow: 0 6px 24px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.03);
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:190px;
    }
    .panel-title{font-weight:600; font-size:16px; letter-spacing:.4px}
    .panel-subtitle{color:var(--muted); font-size:12px}
    .alert-body{display:flex; flex-direction:column; gap:8px; flex:1;}
    .alert-empty{color:var(--muted); font-size:12px;}
    .alert-chip{
      display:flex; align-items:center; gap:6px;
      padding:6px 10px;
      border-radius:10px;
      background:rgba(255,90,95,.08);
      border:1px solid rgba(255,90,95,.35);
      color:#ffd7d9;
      font-size:12px;
    }
    /* .alerts-panel:not(.has-alerts) .panel-card{
      opacity:.7;
    } */

    .gpu-ring-wrap{
      width:72px;
      height:72px;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-shrink:0;
    }
    .gpu-name-switch{
      display:flex;
      align-items:center;
      gap:8px;
      margin-top:6px;
      min-width:0;
    }
    .gpu-name-switch .chip{
      min-width:0;
      flex:1 1 auto;
    }
    .gpu-button{
      width:26px;
      height:26px;
      border-radius:8px;
      border:1px solid var(--grid);
      background:rgba(255,255,255,.08);
      color:var(--text);
      display:grid;
      place-items:center;
      cursor:pointer;
      padding:0;
      font-size:14px;
      transition:background .2s ease, border-color .2s ease, color .2s ease;
      flex:0 0 auto;
    }
    .gpu-button:hover:not(:disabled){
      background:rgba(41,182,246,.16);
      border-color:rgba(41,182,246,.45);
      color:var(--accent);
    }
    .gpu-button:disabled{
      opacity:.3;
      cursor:default;
    }
    .gpu-ring-wrap .ring{ width:72px; height:72px; }

    .name-chip{
      max-width:200px;
      overflow:hidden;
      min-width:0;
    }
    .name-chip.gpu-name{ max-width:240px; }
    .name-chip span{ display:inline-block; white-space:nowrap; }
    .name-chip.marquee{ position:relative; }
    .name-chip.marquee .marquee-track{
      display:inline-flex;
      white-space:nowrap;
      animation: marquee 8s linear infinite;
    }
    .name-chip.marquee .marquee-track span{ padding-right:24px; }
    @keyframes marquee{
      0%{ transform:translateX(0); }
      100%{ transform:translateX(-50%); }
    }
    /* Foreground app title marquee */
    .title-text{
      font-size:18px;
      font-weight:700;
      overflow:hidden;
      text-overflow:ellipsis;
      display:-webkit-box;
      -webkit-box-orient:vertical;
      -webkit-line-clamp:2;
      line-clamp:2;
      white-space:normal;
      word-break:break-word;
    }
    .title-text.marquee{ position:relative; }
    .title-text.marquee .marquee-track{ display:inline-flex; white-space:nowrap; animation: marquee 10s linear infinite; }
    .title-text.marquee .marquee-track span{ padding-right:32px; }
  #fg-top-list{ min-width:0; }
  #fg-top-list .chip{ max-width:100%; min-width:0; }
  #fg-top-list .fg-chip-name{ flex:1; min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

    .temp-card{
      --temp-card-base-height: 140px;
      min-height: var(--temp-card-base-height);
      transition:min-height .3s ease;
    }
    .temp-card.expanded{
      min-height: calc(var(--temp-card-base-height) * 2);
    }
    .temp-card .temp-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
    }
    .temp-highlights{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:6px;
    }
    /* Mini temperature grid shown when collapsed */
    .temp-mini-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap:8px;
      margin-top:10px;
    }
    .temp-card.expanded .temp-mini-grid{ display:none }
    .mini-chip{
      display:flex; flex-direction:column; gap:6px;
      padding:8px 10px; border-radius:10px;
      background:rgba(255,255,255,.04);
      border:1px solid var(--grid);
      min-width:0; /* allow shrink */
    }
    .mini-chip .label{ font-size:11px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .mini-chip .value{ font-size:16px; font-weight:700 }
    .mini-chip.good{ background:rgba(125,216,125,.10); border-color:rgba(125,216,125,.35) }
    .mini-chip.warn{ background:rgba(255,204,0,.10); border-color:rgba(255,204,0,.35) }
    .mini-chip.bad{  background:rgba(255,90,95,.10); border-color:rgba(255,90,95,.35) }
    .mini-bar{ height:6px; border-radius:999px; background:linear-gradient(180deg,#0c141f,#0a111a); border:1px solid var(--grid); overflow:hidden }
    .mini-bar>i{ display:block; height:100%; width:40%; background:linear-gradient(90deg,#58a6ff,#ff8a65) }
    .temp-chip{
      display:flex;
      flex-direction:column;
      gap:4px;
      padding:8px 10px;
      border-radius:12px;
      background:linear-gradient(160deg, rgba(41,182,246,.18), rgba(12,18,27,.6));
      border:1px solid rgba(41,182,246,.35);
      min-width:110px;
    }
    .temp-chip .label{font-size:11px; color:var(--muted)}
    .temp-chip .value{font-size:18px; font-weight:600}
    .temp-toggle{
      border:1px solid var(--grid);
      background:rgba(255,255,255,.04);
      color:var(--text);
      font-size:12px;
      border-radius:8px;
      padding:4px 10px;
      cursor:pointer;
      align-self:flex-start;
    }
    .temp-list-wrapper{
      margin-top:12px;
      border:1px solid var(--grid);
      border-radius:12px;
      background:rgba(255,255,255,.03);
      overflow:hidden;
      max-height:0;
      transition:max-height .3s ease;
    }
    .temp-card.expanded .temp-list-wrapper{
      max-height:360px;
    }
    .temp-list{
      list-style:none;
      margin:0;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:6px;
      max-height:336px;
      overflow:auto;
    }
    .temp-item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:13px;
      padding:6px 8px;
      border-radius:8px;
      background:rgba(255,255,255,.04);
      border:1px solid var(--grid);
    }

    .icon{ width:64px; height:64px; opacity:.9 }

    @media (max-width: 1100px){
      .app{padding:16px}
      .content{flex-direction:column;}
      /* .alerts-panel{width:100%; flex-direction:row;} */
      .panel-card{flex:1; min-height:auto;}
      .grid{ grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: minmax(0, 1fr); }
      .card.span-2{ grid-column: span 1; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <div class="title">系统监控</div>
        <div class="subtitle" id="host">—</div>
      </div>
      <div class="chip" id="clock">00:00:00</div>
    </header>

    <div class="content">
      <main class="grid">
        <section class="card span-2">
          <div class="card-content">
            <div class="row">
               <svg fill="currentColor" t="1761318930160" class="icon" viewBox="0 0 1099 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4952" id="mx_n_1761318930161" data-darkreader-inline-fill="" width="256" height="256"><path d="M906.26 398 906.26 337.2l-72.1 0.2 0-94.3c0-23.9-12.3-37.3-36.2-37.3l-86.9 0 0-73.8-61.5 0 0 73.8-92.4 0L557.16 132l-61.5 0-0.1 73.8L403.16 205.8l0.2-73.8-61.8 0 0.1 73.8-80.9 0c-29.7 0-41.9 13.4-41.7 44.4l-0.6 87.2-73.4 0L145.06 398l73.4 0 0 84.9-73.4-0.1 0 61.5 73.4 0.2 0 86.2-73.4 0 0 60.4 73.4 0 0 82.4c0 34 13.7 48.1 47.8 48.1l75.4 0-0.1 70.8 61.4 0 0.3-70.8 92.4 0 0 70.8 61.7 0-0.1-70.8 92.4 0-0.2 70.8 61.7 0 0.1-70.8 82.3 0c27.6 0 40.8-24.3 40.8-48.1l0-82.4 72.1 0 0-60.4L834.16 630.7l0-86.2 72.1 0 0-61.4-72.1-0.2L834.16 398 906.26 398zM772.56 760 280.06 760 280.06 267.4l492.6 0L772.66 760zM382.96 682.3l295.8 0c11.8 0 16.1-8.1 16.1-18.8L694.86 367c0-12.6-8.6-19.6-18.8-19.6L379.86 347.4c-15.4 0-19.9 5.7-19.9 21.2l0 290.6C359.96 674.6 367.56 682.3 382.96 682.3z" p-id="4953"></path></svg>
              <div class="grow">
                <div class="label">CPU</div>
                <div class="value mono" id="cpu-usage">0%</div>
                <div class="chip small name-chip cpu-name" id="cpu-name-chip"><span>—</span></div>
              </div>
              <div class="ring" id="cpu-ring"><span class="mono" id="cpu-ring-val">0%</span></div>
            </div>
            <div class="kv">
              <div class="label">温度</div><div class="meter"><i id="cpu-temp-bar"></i></div><div class="mono" id="cpu-temp">— ℃</div>
              <div class="label">频率</div><div class="meter"><i id="cpu-clock-bar"></i></div><div class="mono" id="cpu-clock">— MHz</div>
            </div>
          </div>
          <canvas class="spark" id="cpu-spark"></canvas>
        </section>

        <section class="card span-2" id="gpu-card">
          <div class="card-content">
            <div class="row">
              <!-- <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M4 6h16v12H4zM2 8h2v8H2zM20 8h2v8h-2zM8 4h8v2H8zM8 20h8v-2H8z"/></svg> -->
              <svg fill="currentColor" t="1761319215231" class="icon" viewBox="0 0 1874 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9892" data-darkreader-inline-fill="" width="256" height="256" style="transform: rotate(90deg); transform-origin: center; transform-box: fill-box;"><path d="M158.647887 28.84507c8.653521 0 14.422535 5.769014 14.422536 14.422536v937.464788c0 8.653521-5.769014 14.422535-14.422536 14.422536s-14.422535-5.769014-14.422535-14.422536V43.267606c0-8.653521 5.769014-14.422535 14.422535-14.422536z" p-id="9893"></path><path d="M158.647887 187.492958H72.112676v144.225352h86.535211z" p-id="9894"></path><path d="M158.647887 346.140845H72.112676c-8.653521 0-14.422535-5.769014-14.422535-14.422535V187.492958c0-8.653521 5.769014-14.422535 14.422535-14.422535h86.535211c8.653521 0 14.422535 5.769014 14.422536 14.422535v144.225352c0 8.653521-5.769014 14.422535-14.422536 14.422535z m-72.112676-28.84507h57.690141v-115.380282H86.535211v115.380282z" p-id="9895"></path><path d="M158.647887 692.28169H72.112676v144.225352h86.535211z" p-id="9896"></path><path d="M158.647887 850.929577H72.112676c-8.653521 0-14.422535-5.769014-14.422535-14.422535V692.28169c0-8.653521 5.769014-14.422535 14.422535-14.422535h86.535211c8.653521 0 14.422535 5.769014 14.422536 14.422535v144.225352c0 8.653521-5.769014 14.422535-14.422536 14.422535z m-72.112676-28.84507h57.690141v-115.380282H86.535211v115.380282z" p-id="9897"></path><path d="M807.661972 204.8h291.335211l-74.997183 72.112676-36.056338 18.749296H937.464789l-40.383099-7.211268-57.690141-50.478873zM807.661972 814.873239h291.335211l-74.997183-72.112676-36.056338-18.749295H937.464789l-40.383099 8.653521-57.690141 49.036619z" p-id="9898"></path><path d="M807.661972 190.377465h291.335211v28.84507H807.661972z" p-id="9899"></path><path d="M1616.766197 894.197183H1205.723944c-25.960563 0-49.03662-10.095775-67.785916-25.960563l-131.24507-121.149296c-8.653521-7.211268-18.749296-11.538028-28.845071-11.538028h-41.825352c-10.095775 0-20.191549 4.326761-28.84507 10.095774L778.816901 858.140845c-25.960563 23.076056-60.574648 36.056338-95.188732 36.056338H158.647887v-28.84507h524.980282c27.402817 0 54.805634-10.095775 76.439437-28.845071l126.918309-112.495774c12.980282-11.538028 30.287324-17.307042 47.594367-17.307043h41.825352c18.749296 0 36.056338 7.211268 49.03662 18.749296l131.24507 121.149296c12.980282 11.538028 30.287324 18.749296 49.03662 18.749296h411.042253c23.076056 0 46.152113-8.653521 64.901409-23.076057l64.901408-53.36338c25.960563-21.633803 41.825352-54.805634 41.825352-89.419718v-389.408451c0-20.191549-8.653521-40.383099-24.51831-54.805634l-82.20845-72.112676c-18.749296-15.864789-41.825352-24.51831-66.343662-24.51831H1204.28169c-17.307042 0-34.614085 7.211268-47.594366 18.749296L1024 295.661972c-12.980282 11.538028-30.287324 18.749296-47.594366 18.749296h-43.267606c-17.307042 0-34.614085-5.769014-47.594366-17.307043L758.625352 187.492958c-20.191549-18.749296-47.594366-28.84507-74.997183-28.845071H158.647887V129.802817h524.980282c34.614085 0 67.785915 12.980282 93.746479 34.614084l126.91831 109.611268c7.211268 7.211268 17.307042 10.095775 28.84507 10.095775h43.267606c10.095775 0 21.633803-4.326761 28.84507-11.538029l132.687324-118.264788C1156.687324 138.456338 1179.76338 129.802817 1204.28169 129.802817H1615.323944c31.729577 0 62.016901 11.538028 85.092957 31.729577l82.208451 72.112676c21.633803 18.749296 34.614085 46.152113 34.614085 76.439437v389.408451c0 43.267606-18.749296 83.650704-51.921127 111.053521l-64.901409 53.36338c-24.51831 20.191549-53.36338 30.287324-83.650704 30.287324z" p-id="9900"></path><path d="M980.732394 274.028169h-43.267605c-8.653521 0-14.422535-5.769014-14.422535-14.422535s5.769014-14.422535 14.422535-14.422535h43.267605c8.653521 0 14.422535 5.769014 14.422536 14.422535s-5.769014 14.422535-14.422536 14.422535zM980.732394 778.816901h-43.267605c-8.653521 0-14.422535-5.769014-14.422535-14.422535s5.769014-14.422535 14.422535-14.422535h43.267605c8.653521 0 14.422535 5.769014 14.422536 14.422535s-5.769014 14.422535-14.422536 14.422535zM807.661972 796.123944h291.335211v28.84507H807.661972z" p-id="9901"></path><path d="M522.095775 584.833803c2.884507 98.073239-72.112676 165.859155-92.304226 180.28169 89.419718 34.614085 177.397183 23.076056 261.047888-36.056338-15.864789-89.419718-53.36338-149.994366-109.611268-181.723944-21.633803 24.51831-30.287324 27.402817-59.132394 37.498592zM468.732394 492.529577c-80.766197-54.805634-90.861972-155.76338-90.861971-178.839436-80.766197 51.921127-122.591549 129.802817-124.033803 233.64507 82.208451 38.940845 152.878873 44.709859 212.011267 17.307043-10.095775-33.171831-5.769014-41.825352 2.884507-72.112677zM588.439437 486.760563c86.535211-46.152113 180.28169-11.538028 201.915493 0-10.095775-96.630986-60.574648-168.743662-151.43662-216.338028-72.112676 54.805634-109.611268 115.380282-112.495775 180.28169 33.171831 7.211268 40.383099 14.422535 62.016902 36.056338z" p-id="9902"></path><path d="M526.422535 793.239437C370.659155 793.239437 245.183099 667.76338 245.183099 512S370.659155 230.760563 526.422535 230.760563 807.661972 356.23662 807.661972 512 682.185915 793.239437 526.422535 793.239437z m0-533.633803C387.966197 259.605634 274.028169 373.543662 274.028169 512S387.966197 764.394366 526.422535 764.394366 778.816901 650.456338 778.816901 512 664.878873 259.605634 526.422535 259.605634z" p-id="9903"></path><path d="M540.84507 451.425352l-28.84507-1.442253c2.884507-69.228169 41.825352-132.687324 116.822535-190.377465l17.307042 23.076056c-67.785915 51.921127-102.4 108.169014-105.284507 168.743662zM787.470423 506.230986c-62.016901-34.614085-128.360563-37.498592-204.8-4.326761l-11.538029-25.960563c83.650704-34.614085 160.090141-33.171831 229.31831 5.769014l-12.980281 24.51831zM666.321127 739.876056c-10.095775-80.766197-38.940845-142.783099-89.419719-183.166197l18.749296-21.633803c56.247887 46.152113 89.419718 113.938028 99.515493 201.915493l-28.84507 2.884507zM421.138028 771.605634l-15.864789-24.51831c59.132394-38.940845 98.073239-96.630986 116.822536-173.070423l27.402817 7.211268c-20.191549 83.650704-63.459155 147.109859-128.360564 190.377465zM392.292958 576.901408c-44.709859 0-92.304225-10.095775-141.340845-30.287323l11.538028-25.960564c77.88169 31.729577 149.994366 37.498592 213.453521 14.422535l10.095775 27.402817c-31.729577 10.095775-62.016901 14.422535-93.746479 14.422535zM455.752113 497.577465c-49.03662-38.940845-87.977465-102.4-115.380282-187.492958l27.402817-8.653521c25.960563 80.766197 62.016901 138.456338 105.284507 174.512676l-17.307042 21.633803z" p-id="9904"></path><path d="M526.422535 591.323944c-43.267606 0-79.323944-36.056338-79.323943-79.323944s36.056338-79.323944 79.323943-79.323944 79.323944 36.056338 79.323944 79.323944-36.056338 79.323944-79.323944 79.323944z m0-129.802817c-27.402817 0-50.478873 23.076056-50.478873 50.478873s23.076056 50.478873 50.478873 50.478873 50.478873-23.076056 50.478873-50.478873-23.076056-50.478873-50.478873-50.478873z" p-id="9905"></path><path d="M1307.489352 545.388169c-85.669859 47.796282-180.094197 14.047549-201.425127 3.043155 12.23031 96.19831 62.997634 166.811042 154.970141 213.626591 70.958873-55.959437 107.361352-116.937915 107.967099-182.228732-31.340169-5.23538-38.883155-12.547606-61.512113-34.441014zM1356.612507 448.757183c6.345915-98.606873 86.765972-158.359437 107.274817-171.858929-86.592901-43.267606-174.757859-37.325521-263.442028 13.874478 8.624676 89.93893 40.224451 153.311549 93.515718 190.810141 23.148169-23.364507 33.330479-25.902873 62.651493-32.82569zM1420.922592 551.517746c82.525746 50.608676 97.45307 148.566535 99.515493 172.349296 79.367211-55.815211 116.577352-135.571831 113.072676-236.818028-82.785352-33.792-153.989408-35.984225-210.929578-4.788282 9.619831 31.094986 6.25938 39.690817-1.658591 69.242592z" p-id="9906"></path><path d="M1363.477634 793.48462c-155.76338 0-281.239437-125.476056-281.239437-281.239437s125.476056-281.239437 281.239437-281.239437 281.239437 125.476056 281.239436 281.239437c0 154.321127-126.91831 281.239437-281.239436 281.239437z m0-533.633803c-138.456338 0-252.394366 113.938028-252.394366 252.394366s112.495775 252.394366 252.394366 252.394366 252.394366-113.938028 252.394366-252.394366-113.938028-252.394366-252.394366-252.394366z" p-id="9907"></path><path d="M1377.900169 451.670535l-28.84507-1.442253c2.884507-69.228169 41.825352-134.129577 116.822535-191.819719l17.307042 23.076057c-67.785915 53.36338-103.842254 109.611268-105.284507 170.185915zM1623.083268 505.033915c-62.016901-34.614085-128.360563-37.498592-204.8-4.32676l-11.538029-25.960563c83.650704-34.614085 160.090141-33.171831 229.31831 5.769014l-12.980281 24.518309zM1501.933972 740.121239c-10.095775-80.766197-38.940845-142.783099-89.419718-183.166197l18.749295-21.633803c56.247887 46.152113 89.419718 113.938028 99.515493 201.915493l-28.84507 2.884507zM1256.750873 771.850817l-15.864788-24.51831c59.132394-38.940845 98.073239-96.630986 116.822535-173.070422l27.402817 7.211267c-18.749296 82.208451-63.459155 147.109859-128.360564 190.377465zM1227.905803 577.146592c-44.709859 0-92.304225-10.095775-141.340845-30.287324l11.538028-25.960564c77.88169 31.729577 149.994366 37.498592 213.453521 14.422535l10.095775 27.402817c-30.287324 10.095775-60.574648 14.422535-93.746479 14.422536zM1292.807211 497.822648c-49.03662-38.940845-87.977465-102.4-115.380281-187.492958l27.402816-8.653521c25.960563 79.323944 62.016901 138.456338 106.726761 174.512676l-18.749296 21.633803z" p-id="9908"></path><path d="M1363.477634 591.569127c-43.267606 0-79.323944-36.056338-79.323944-79.323944s36.056338-79.323944 79.323944-79.323944 79.323944 36.056338 79.323943 79.323944-36.056338 79.323944-79.323943 79.323944z m0-129.802817c-27.402817 0-50.478873 23.076056-50.478873 50.478873s23.076056 50.478873 50.478873 50.478873 50.478873-23.076056 50.478873-50.478873-23.076056-50.478873-50.478873-50.478873z" p-id="9909"></path><path d="M1730.704225 331.71831h57.690141c8.653521 0 14.422535 5.769014 14.422535 14.422535s-5.769014 14.422535-14.422535 14.422535h-57.690141c-8.653521 0-14.422535-5.769014-14.422535-14.422535s5.769014-14.422535 14.422535-14.422535zM1730.704225 490.366197h57.690141c8.653521 0 14.422535 5.769014 14.422535 14.422535s-5.769014 14.422535-14.422535 14.422536h-57.690141c-8.653521 0-14.422535-5.769014-14.422535-14.422536s5.769014-14.422535 14.422535-14.422535zM1730.704225 663.43662h57.690141c8.653521 0 14.422535 5.769014 14.422535 14.422535s-5.769014 14.422535-14.422535 14.422535h-57.690141c-8.653521 0-14.422535-5.769014-14.422535-14.422535s5.769014-14.422535 14.422535-14.422535z" p-id="9910"></path></svg>
              <div class="grow">
                <div class="label">GPU</div>
                <div class="value mono" id="gpu-usage">0%</div>
                <div class="gpu-name-switch">
                  <button type="button" class="gpu-button prev" id="gpu-prev" aria-label="上一块 GPU">&#60;</button>
                  <div class="chip small name-chip gpu-name" id="gpu-name-chip"><span>—</span></div>
                  <button type="button" class="gpu-button next" id="gpu-next" aria-label="下一块 GPU">&#62;</button>
                </div>
              </div>
              <div class="gpu-ring-wrap">
                <div class="ring" id="gpu-ring" style="--col:var(--accent2)"><span class="mono" id="gpu-ring-val">0%</span></div>
              </div>
            </div>
            <div class="kv">
              <div class="label">温度</div><div class="meter"><i id="gpu-temp-bar" style="background:linear-gradient(90deg,var(--accent2),#ff8a65)"></i></div><div class="mono" id="gpu-temp">— ℃</div>
              <div class="label">频率</div><div class="meter"><i id="gpu-clock-bar" style="background:linear-gradient(90deg,var(--accent2),#ff8a65)"></i></div><div class="mono" id="gpu-clock">— MHz</div>
              <div class="label">显存</div><div class="meter"><i id="gpu-memory-bar" style="background:linear-gradient(90deg,var(--accent2),#ff8a65)"></i></div><div class="mono" id="gpu-memory">—</div>
            </div>
          </div>
          <canvas class="spark" id="gpu-spark"></canvas>
        </section>

        <section class="card">
          <div class="card-content">
            <div class="row" style="align-items:center">
              <div class="grow">
                <div class="label">内存概览</div>
                <div class="value mono"><span id="mem-used">--</span> / <span id="mem-total">--</span> <span class="unit">GB</span></div>
              </div>
              <div class="ring" id="mem-ring" style="--col:var(--accent3)"><span class="mono">0%</span></div>
            </div>
            <div class="chip-row">
              <div class="chip small" id="mem-speed-chip">
                <span class="chip-label">内存速度</span>
                <span class="chip-value mono" id="mem-speed">-- MHz</span>
              </div>
              <div class="chip small" id="mem-virtual-chip">
                <span class="chip-label">虚拟内存总量</span>
                <span class="chip-value mono" id="mem-virtual-total">-- MB</span>
              </div>
              <div class="chip small" id="mem-pressure-chip">
                <span class="chip-label">压力状态</span>
                <span class="chip-value mono" id="mem-pressure">--</span>
              </div>
            </div>
          </div>
          <canvas class="spark" id="mem-spark"></canvas>
        </section>

        <section class="card" id="fg-card">
          <div class="card-content">
            <div class="row">
              <!-- <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M5 3h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-4l-3 3-3-3H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm2 4v2h10V7H7zm0 4v2h7v-2H7z"/></svg> -->
              <div class="grow">
                <div class="label">前台应用</div>
                <div class="value title-text" id="fg-app-name">—</div>
                <div class="chip small" id="fg-process-name">—</div>
              </div>
            </div>
            <div class="kv">
              <div class="label">CPU</div><div class="meter"><i id="fg-cpu-bar"></i></div><div class="mono" id="fg-cpu">— %</div>
              <div class="label">内存</div><div class="meter"><i id="fg-mem-bar" style="background:linear-gradient(90deg,var(--accent3),#a5d66a)"></i></div><div class="mono" id="fg-mem">— MB</div>
            </div>
            <div class="chip-row" id="fg-top-list" style="margin-top:6px"></div>
          </div>
        </section>



        <section class="card">
          <div class="card-content">
            <div class="row">
              <!-- <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3a9 9 0 0 1 9 9h-3a6 6 0 1 0-12 0H3a9 9 0 0 1 9-9zm0 6a3 3 0 0 1 3 3h-3V6zm0 12a9 9 0 0 1-9-9h3a6 6 0 0 0 12 0h3a9 9 0 0 1-9 9z"/></svg> -->
              <div class="grow">
                <div class="label">网络</div>
                <div class="gpu-name-switch net-name-switch">
                  <button type="button" class="gpu-button prev" id="net-prev" aria-label="上一块网卡">&#60;</button>
                  <div class="chip small name-chip net-name" id="net-name-chip"><span>—</span></div>
                  <button type="button" class="gpu-button next" id="net-next" aria-label="下一块网卡">&#62;</button>
                </div>
                <div class="mono"  style="padding-top: 5px; padding-left: 10px;">↑ <span id="net-up">0.0</span> MB/s &nbsp; ↓ <span id="net-down">0.0</span> MB/s</div>
                <div class="chip-row" style="padding-top: 5px; padding-left: 6px; gap:6px">
                  <div class="chip small" id="net-link-chip"></div>
                </div>
                <div class="chip-row" style="padding-top: 5px; padding-left: 6px; gap:6px" id="net-ip-list"></div>
              </div>
            </div>
          </div>
          <canvas class="spark" id="net-spark"></canvas>
        </section>

        <section class="card">
          <div class="card-content">
            <div class="row">
              <!-- <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h16v16H4zM6 6v4h12V6H6zm0 6v6h12v-6H6z"/></svg> -->
              <div class="grow">
                <div class="label">磁盘 I/O</div>
                <div class="mono">R <span id="disk-r">0.0</span> MB/s &nbsp; W <span id="disk-w">0.0</span> MB/s</div>
                <div class="chip-row" style="margin-top:6px">
                  <div class="chip small" id="disk-total-chip">
                    <span class="chip-label">总吞吐</span>
                    <span class="chip-value mono" id="disk-total">0.0 MB/s</span>
                  </div>
                  <div class="chip small" id="disk-rw-chip">
                    <span class="chip-label">读/写占比</span>
                    <span class="chip-value mono" id="disk-rw-ratio">—</span>
                  </div>
                  <div class="chip small" id="disk-peak-chip">
                    <span class="chip-label">最近峰值</span>
                    <span class="chip-value mono" id="disk-peak">0.0 MB/s</span>
                  </div>
                </div>
                <div class="kv" style="margin-top:6px">
                  <div class="label">活跃度</div>
                  <div class="meter"><i id="disk-activity-bar"></i></div>
                  <div class="mono" id="disk-activity-text">— %</div>
                </div>
              </div>
            </div>
          </div>
          <canvas class="spark" id="disk-spark"></canvas>
        </section>



        <section class="card span-2 temp-card" id="temp-card">
          <div class="temp-header">
            <div>
              <div class="label">温度传感器</div>
              <div class="temp-highlights" id="temp-highlights">
                <div class="temp-chip">
                  <div class="label">CPU 封装</div>
                  <div class="value mono">—</div>
                </div>
                <div class="temp-chip">
                  <div class="label">CPU 核心</div>
                  <div class="value mono">—</div>
                </div>
                <div class="temp-chip">
                  <div class="label">主板</div>
                  <div class="value mono">—</div>
                </div>
              </div>
            </div>
            <button class="temp-toggle" id="temp-toggle">展开</button>
          </div>
          <!-- Top hottest sensors preview (collapsed only) -->
          <div class="temp-mini-grid" id="temp-mini-grid"></div>
          <div class="temp-list-wrapper">
            <ul class="temp-list" id="temp-list"></ul>
          </div>
        </section>
      </main>

      <!-- <aside class="alerts-panel" id="alerts-panel">
        <div class="panel-card">
          <div>
            <div class="panel-title">告警</div>
            <div class="panel-subtitle">实时监控</div>
          </div>
          <div class="alert-body" id="alert-list">
            <div class="alert-empty">当前无告警</div>
          </div>
        </div>
      </aside> -->
    </div>

    <footer>
      <div id="source" class="subtitle">数据源：LibreHardwareMonitor</div>
      <div class="mono" id="ver">—</div>
    </footer>
  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const setText = (id, v)=>{ const el=$(id); if(el) el.textContent = v };
    function clamp(n,min,max){ return Math.max(min, Math.min(max, n)) }

    class Spark{
      constructor(canvas, capacity=120, yMaxHint=100){
        this.c = canvas; this.ctx = canvas.getContext('2d');
        this.buf = []; this.capacity = capacity; this.yMaxHint = yMaxHint;
        const dpr = Math.max(1, window.devicePixelRatio||1);
        const rect = this.c.getBoundingClientRect();
        this.c.width = rect.width * dpr; this.c.height = rect.height * dpr;
        this.ctx.scale(dpr, dpr);
      }
      push(v){
        this.buf.push(v ?? 0); if(this.buf.length>this.capacity) this.buf.shift();
        this.draw();
      }
      draw(){
        const w = this.c.clientWidth, h=this.c.clientHeight;
        const ctx=this.ctx; ctx.clearRect(0,0,w,h);
        ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--grid');
        ctx.lineWidth = 1; ctx.beginPath();
        for(let y=0;y<=h;y+=10){ctx.moveTo(0,y);ctx.lineTo(w,y);} ctx.stroke();
        if(this.buf.length<2) return;
        const max = Math.max(this.yMaxHint, ...this.buf, 1);
        ctx.beginPath();
        ctx.strokeStyle = '#58a6ff';
        ctx.lineWidth = 2; ctx.lineJoin='round'; ctx.lineCap='round';
        for(let i=0;i<this.buf.length;i++){
          const x = i * (w/(this.capacity-1));
          const y = h - (this.buf[i]/max)*h;
          i?ctx.lineTo(x,y):ctx.moveTo(x,y);
        }
        ctx.stroke();
        const grad = ctx.createLinearGradient(0,0,0,h);
        grad.addColorStop(0,'rgba(88,166,255,.28)');
        grad.addColorStop(1,'rgba(88,166,255,0)');
        ctx.lineTo(w,h); ctx.lineTo(0,h); ctx.closePath();
        ctx.fillStyle = grad; ctx.fill();
      }
    }

    function setRing(el, percent){
      if(!el) return;
      percent = clamp(percent ?? 0, 0, 100);
      el.style.setProperty('--p', percent);
      el.querySelector('span').textContent = Math.round(percent) + '%';
    }
    function setMeter(el, percent){
      if(!el) return;
      el.style.width = clamp(percent ?? 0,0,100) + '%';
    }

    function setChipText(chipEl, text){
      if(!chipEl) return;
      const value = text && text.trim().length ? text : '—';
      chipEl.classList.remove('marquee');
      chipEl.innerHTML = `<span>${value}</span>`;
      requestAnimationFrame(() => {
        const span = chipEl.querySelector('span');
        if(!span) return;
        if(span.scrollWidth > chipEl.clientWidth){
          chipEl.classList.add('marquee');
          chipEl.innerHTML = `<div class="marquee-track"><span>${value}</span><span>${value}</span></div>`;
        }
      });
    }

    function setTitleText(el, text){
      if(!el) return;
      const value = (text ?? '—').toString();
      el.classList.remove('marquee');
      el.textContent = value;
      if(value === '—'){
        el.removeAttribute('title');
      } else {
        el.title = value;
      }
    }

    const cpuSpark = new Spark($('#cpu-spark'), 120, 100);
    const gpuSpark = new Spark($('#gpu-spark'), 120, 100);
    const memSpark = new Spark($('#mem-spark'), 120, 100);
    const netSpark = new Spark($('#net-spark'), 120, 20);
    const diskSpark= new Spark($('#disk-spark'),120, 20);
    const cpuRingEl = document.getElementById('cpu-ring');
    const gpuRingEl = document.getElementById('gpu-ring');
    const cpuTempBar = document.getElementById('cpu-temp-bar');
    const cpuClockBar = document.getElementById('cpu-clock-bar');
    const gpuTempBar = document.getElementById('gpu-temp-bar');
    const gpuClockBar = document.getElementById('gpu-clock-bar');
    const gpuMemoryBar = document.getElementById('gpu-memory-bar');
    const memRingEl = document.getElementById('mem-ring');
    const memPressureEl = document.getElementById('mem-pressure');
    const memPressureChip = document.getElementById('mem-pressure-chip');
    // const alertsPanel = document.getElementById('alerts-panel');
    const alertListEl = document.getElementById('alert-list');
    const cpuNameChip = document.getElementById('cpu-name-chip');
    const gpuNameChip = document.getElementById('gpu-name-chip');
  const netNameChip = document.getElementById('net-name-chip');
  const netLinkChip = document.getElementById('net-link-chip');
  const netIpListEl = document.getElementById('net-ip-list');
    const gpuPrevBtn = document.getElementById('gpu-prev');
    const gpuNextBtn = document.getElementById('gpu-next');
    const netPrevBtn = document.getElementById('net-prev');
    const netNextBtn = document.getElementById('net-next');
    const tempCard = document.getElementById('temp-card');
    const tempToggleBtn = document.getElementById('temp-toggle');
    const tempListEl = document.getElementById('temp-list');
    const tempHighlightsEl = document.getElementById('temp-highlights');
  const tempMiniGridEl = document.getElementById('temp-mini-grid');
    let tempCardBaseHeight = 140;
    const updateTempCardBaseHeight = () => {
      if(tempCard.classList.contains('expanded')) return tempCardBaseHeight;
      const measured = Math.max(tempCard.offsetHeight, 140);
      tempCardBaseHeight = measured;
      tempCard.style.setProperty('--temp-card-base-height', `${Math.round(measured)}px`);
      return measured;
    };
    updateTempCardBaseHeight();
    requestAnimationFrame(updateTempCardBaseHeight);
    const fgAppNameEl = document.getElementById('fg-app-name');
    const fgProcessNameEl = document.getElementById('fg-process-name');
    const fgCpuBar = document.getElementById('fg-cpu-bar');
    const fgCpuTextEl = document.getElementById('fg-cpu');
    const fgMemBar = document.getElementById('fg-mem-bar');
    const fgMemTextEl = document.getElementById('fg-mem');
  const fgTopListEl = document.getElementById('fg-top-list');
  // Disk UI extras
  const diskActivityBar = document.getElementById('disk-activity-bar');
  const diskActivityText = document.getElementById('disk-activity-text');
  const diskTotalTextEl = document.getElementById('disk-total');
  const diskRwRatioEl = document.getElementById('disk-rw-ratio');
  const diskPeakTextEl = document.getElementById('disk-peak');

    let netList = [];
    let netIndex = 0;
    let netSummary = null;
    let gpuList = [];
    let gpuIndex = 0;
    let latestTemps = [];
    let tempHighlights = [];
    let totalMemoryGb = 0;
  // rolling history for disk total throughput (MB/s)
  const diskHistory = [];
  const diskHistoryCap = 120;

    setInterval(()=>{
      const d=new Date();
      setText('#clock', d.toLocaleTimeString());
    }, 1000);

    if(netPrevBtn){ netPrevBtn.disabled = true; }
    if(netNextBtn){ netNextBtn.disabled = true; }

    gpuPrevBtn.addEventListener('click', ()=>switchGpu(-1));
    gpuNextBtn.addEventListener('click', ()=>switchGpu(1));
    if(netPrevBtn){ netPrevBtn.addEventListener('click', ()=>switchNet(-1)); }
    if(netNextBtn){ netNextBtn.addEventListener('click', ()=>switchNet(1)); }
    tempToggleBtn.addEventListener('click', ()=>{
      const willExpand = !tempCard.classList.contains('expanded');
      if(willExpand){
        updateTempCardBaseHeight();
        tempCard.classList.add('expanded');
        tempToggleBtn.textContent = '收起';
      } else {
        tempCard.classList.remove('expanded');
        tempToggleBtn.textContent = '展开';
        setTimeout(updateTempCardBaseHeight, 320);
      }
      renderTempList();
    });

    function switchGpu(step){
      if(!gpuList.length) return;
      gpuIndex = (gpuIndex + step + gpuList.length) % gpuList.length;
      renderGpuCard(false);
    }

    function renderGpuCard(push){
      const gpu = gpuList[gpuIndex] ?? null;
      gpuPrevBtn.disabled = gpuList.length <= 1;
      gpuNextBtn.disabled = gpuList.length <= 1;

      if(gpu){
        setChipText(gpuNameChip, gpu.name || `GPU ${gpuIndex + 1}`);
        const usage = gpu.usage ?? 0;
        setText('#gpu-usage', Math.round(usage) + '%');
        setRing(gpuRingEl, usage);
        const temp = gpu.temp ?? null;
        setText('#gpu-temp', temp != null ? `${temp.toFixed(0)} ℃` : '— ℃');
        setMeter(gpuTempBar, temp != null ? clamp(temp, 0, 110) : 0);
        const clock = gpu.clock ?? null;
        setText('#gpu-clock', clock != null ? `${clock.toFixed(0)} MHz` : '— MHz');
        setMeter(gpuClockBar, clock != null ? clamp(clock / 3000 * 100, 0, 100) : 0);
        const memoryUsed = typeof gpu.memoryUsed === 'number' && !Number.isNaN(gpu.memoryUsed) ? gpu.memoryUsed : null;
        const memoryTotal = typeof gpu.memoryTotal === 'number' && !Number.isNaN(gpu.memoryTotal) ? gpu.memoryTotal : null;
  // Debug log removed; use DevTools if needed to inspect gpu object
        let memoryPct = typeof gpu.memoryUsage === 'number' && !Number.isNaN(gpu.memoryUsage) ? gpu.memoryUsage : null;
        if(memoryPct == null && memoryUsed != null && memoryTotal != null && memoryTotal > 0){
          memoryPct = memoryUsed / memoryTotal * 100;
        }
        let memoryText = '—';
        if(memoryUsed != null && memoryTotal != null && memoryTotal > 0){
          const usedText = memoryUsed >= 10 ? memoryUsed.toFixed(0) : memoryUsed.toFixed(1);
          const totalText = memoryTotal >= 10 ? memoryTotal.toFixed(0) : memoryTotal.toFixed(1);
          memoryText = `${usedText} / ${totalText} GB`;
          if(memoryPct != null){
            memoryText += ` (${Math.round(memoryPct)}%)`;
          }
        } else if(memoryPct != null){
          memoryText = `${Math.round(memoryPct)}%`;
        } else if(memoryUsed != null){
          memoryText = `${memoryUsed.toFixed(1)} GB`;
        }
        setText('#gpu-memory', memoryText);
        setMeter(gpuMemoryBar, memoryPct != null ? clamp(memoryPct, 0, 100) : 0);
        if(push) gpuSpark.push(usage);
      } else {
        setChipText(gpuNameChip, '—');
        setText('#gpu-usage', '—');
        setRing(gpuRingEl, 0);
        if(gpuRingEl){ gpuRingEl.querySelector('span').textContent = '—'; }
        setText('#gpu-temp', '— ℃');
        setMeter(gpuTempBar, 0);
        setText('#gpu-clock', '— MHz');
        setMeter(gpuClockBar, 0);
        setText('#gpu-memory', '—');
        setMeter(gpuMemoryBar, 0);
        if(push) gpuSpark.push(0);
      }
    }

    function switchNet(step){
      if(!netList.length) return;
      netIndex = (netIndex + step + netList.length) % netList.length;
      renderNetCard(false);
    }

    function renderNetCard(push){
      const adapter = netList[netIndex] ?? null;

      if(netPrevBtn){ netPrevBtn.disabled = netList.length <= 1; }
      if(netNextBtn){ netNextBtn.disabled = netList.length <= 1; }

      if(adapter){
        setChipText(netNameChip, adapter.name || `网卡 ${netIndex + 1}`);
        const up = typeof adapter.upMBps === 'number' && !Number.isNaN(adapter.upMBps) ? adapter.upMBps : 0;
        const down = typeof adapter.downMBps === 'number' && !Number.isNaN(adapter.downMBps) ? adapter.downMBps : 0;
        setText('#net-up', up.toFixed(1));
        setText('#net-down', down.toFixed(1));
        // link meta
        const linkMbps = typeof adapter.linkSpeedMbps === 'number' && isFinite(adapter.linkSpeedMbps) ? adapter.linkSpeedMbps : null;
        const typeText = adapter.connectionType === 'wireless' ? '无线' : (adapter.connectionType === 'wired' ? '有线' : null);
        let speedText = null;
        if(linkMbps != null){
          speedText = linkMbps >= 1000 ? `${(linkMbps/1000).toFixed(1)} Gbps` : `${Math.round(linkMbps)} Mbps`;
        }
        const metaText = typeText && speedText ? `${typeText} · ${speedText}` : (typeText || speedText || '—');
        if(netLinkChip){ setChipText(netLinkChip, metaText); }
        const ips = Array.isArray(adapter.ips) ? adapter.ips : (Array.isArray(adapter.ipAddresses) ? adapter.ipAddresses : []);
        renderNetIps(ips);
        if(push) netSpark.push(up + down);
        return;
      }

      if(netPrevBtn){ netPrevBtn.disabled = true; }
      if(netNextBtn){ netNextBtn.disabled = true; }
  setChipText(netNameChip, '—');
  if(netLinkChip){ setChipText(netLinkChip, '—'); }
  renderNetIps([]);

      const fallbackUp = netSummary && typeof netSummary.upMBps === 'number' && !Number.isNaN(netSummary.upMBps) ? netSummary.upMBps : 0;
      const fallbackDown = netSummary && typeof netSummary.downMBps === 'number' && !Number.isNaN(netSummary.downMBps) ? netSummary.downMBps : 0;
      setText('#net-up', fallbackUp.toFixed(1));
      setText('#net-down', fallbackDown.toFixed(1));
      if(push) netSpark.push(fallbackUp + fallbackDown);
    }

    function renderNetIps(ips){
      if(!netIpListEl) return;
      const list = Array.isArray(ips) ? ips.filter(ip => typeof ip === 'string' && ip.length) : [];
      const maxChips = 3;
      const shown = list.slice(0, maxChips);
      const extra = list.length - shown.length;
      netIpListEl.innerHTML = '&nbsp;IP:';
      const frag = document.createDocumentFragment();
      shown.forEach(ip => {
        const chip = document.createElement('div');
        chip.className = 'chip small ip-chip';
        chip.textContent = ip;
        chip.title = '点击复制';
        chip.addEventListener('click', async () => {
          try{
            await navigator.clipboard?.writeText(ip);
            const prev = chip.textContent;
            chip.textContent = '已复制';
            setTimeout(()=>{ chip.textContent = prev; }, 800);
          }catch{}
        }, { once: false });
        frag.appendChild(chip);
      });
      if(extra > 0){
        const more = document.createElement('div');
        more.className = 'chip small';
        more.textContent = `+${extra}`;
        frag.appendChild(more);
      }
      netIpListEl.appendChild(frag);
    }

function renderTempHighlights(){
  if(!tempHighlightsEl) return;

  const highlights = tempHighlights
    .filter(h => typeof h.valueC === 'number')
    .map(h => ({ label: h.label, value: h.valueC }))
    .slice(0, 3);

  if(!highlights.length){
    tempHighlightsEl.innerHTML = `
      <div class="temp-chip">
        <div class="label">无可用数据</div>
        <div class="value mono">—</div>
      </div>`;
    return;
  }

  tempHighlightsEl.innerHTML = highlights
    .map(item => `
      <div class="temp-chip">
        <div class="label">${item.label}</div>
        <div class="value mono">${item.value.toFixed(1)} ℃</div>
      </div>`)
    .join("");
}

function renderTempList(){
  if(!latestTemps.length){
    renderTempHighlights();
    renderTempMiniGrid();
    if(tempCard.classList.contains('expanded')){
      tempListEl.innerHTML = '';
    }
    return;
  }

  renderTempHighlights();
  renderTempMiniGrid();

  if(!tempCard.classList.contains('expanded')){
    return;
  }

  const orderedTemps = [...latestTemps].sort((a,b) => (b.valueC ?? -Infinity) - (a.valueC ?? -Infinity));

  tempListEl.innerHTML = orderedTemps
    .map(entry => {
      const value = entry.valueC != null ? `${entry.valueC.toFixed(1)} ℃` : '—';
      return `<li class="temp-item"><span>${entry.hardware} · ${entry.sensor}</span><span class="mono">${value}</span></li>`;
    })
    .join('');
}

function getTempSeverityClass(c){
  if(c == null || !isFinite(c)) return '';
  if(c >= 80) return 'bad';
  if(c >= 60) return 'warn';
  return 'good';
}

function renderTempMiniGrid(){
  if(!tempMiniGridEl){ return; }
  const temps = Array.isArray(latestTemps) ? latestTemps.filter(t => typeof t.valueC === 'number' && isFinite(t.valueC)) : [];
  if(!temps.length){ tempMiniGridEl.innerHTML = ''; return; }

  // Build items: use top 6 hottest unique labels
  const items = [...temps]
    .map(t => ({ label: `${t.hardware} · ${t.sensor}`, value: t.valueC }))
    .sort((a,b) => b.value - a.value);

  const seen = new Set();
  const top = [];
  for(const it of items){
    const key = it.label.toLowerCase();
    if(seen.has(key)) continue;
    seen.add(key);
    top.push(it);
    if(top.length >= 3) break;
  }

  const html = top.map(it => {
    const pct = clamp((it.value / 100) * 100, 0, 100);
    const sev = getTempSeverityClass(it.value);
    return `<div class="mini-chip ${sev}">
      <div class="label" title="${it.label}">${it.label}</div>
      <div class="value mono">${it.value.toFixed(1)} ℃</div>
      <div class="mini-bar"><i style="width:${pct}%"></i></div>
    </div>`;
  }).join('');
  tempMiniGridEl.innerHTML = html;
}

function formatDuration(totalSeconds){
  totalSeconds = Math.max(0, Math.floor(totalSeconds||0));
  const h = Math.floor(totalSeconds/3600);
  const m = Math.floor((totalSeconds%3600)/60);
  const s = totalSeconds%60;
  const pad = n => n.toString().padStart(2,'0');
  return h>0 ? `${h}:${pad(m)}:${pad(s)}` : `${m}:${pad(s)}`;
}

function renderTopForegroundApps(list){
  if(!fgTopListEl) return;
  const arr = Array.isArray(list) ? list.slice(0,3) : [];
  fgTopListEl.innerHTML = '';
  if(arr.length === 0){ return; }
  const fragment = document.createDocumentFragment();
  arr.forEach(it => {
    const name = it.displayTitle || it.name || '—';
    const dur = formatDuration(it.totalSeconds || 0);

    const chip = document.createElement('div');
    chip.className = 'chip small';

    const labelSpan = document.createElement('span');
    labelSpan.className = 'chip-label';
    labelSpan.textContent = '累计';

    const valueSpan = document.createElement('span');
    valueSpan.className = 'chip-value';
    valueSpan.textContent = dur;

    const separator = document.createElement('span');
    separator.style.opacity = '.6';
    separator.textContent = ' · ';

    const nameSpan = document.createElement('span');
    nameSpan.className = 'mono fg-chip-name';
    nameSpan.textContent = name;
    if(name && name !== '—'){
      nameSpan.title = name;
    }

    chip.append(labelSpan, valueSpan, separator, nameSpan);
    fragment.appendChild(chip);
  });
  fgTopListEl.appendChild(fragment);
}

    window.updateMetrics = function(m){
      if(m.cpu){
        const usage = m.cpu.usage ?? 0;
        setText('#cpu-usage', Math.round(usage)+'%');
        setRing(cpuRingEl, usage);
        const temp = m.cpu.temp ?? null;
        setText('#cpu-temp', temp!=null ? `${temp.toFixed(0)} ℃` : '— ℃');
        setMeter(cpuTempBar, temp!=null ? clamp(temp,0,100) : 0);
        const clock = m.cpu.clock ?? null;
        setText('#cpu-clock', clock!=null ? `${clock.toFixed(0)} MHz` : '— MHz');
        setMeter(cpuClockBar, clock!=null ? clamp(clock/6000*100,0,100) : 0);
        cpuSpark.push(usage);
        setChipText(cpuNameChip, m.cpu.name ?? '—');
      }
      if(Array.isArray(m.gpus)){
        const currentName = gpuList[gpuIndex]?.name;
        const prioritized = [...m.gpus].sort((a, b) => {
          const aName = a?.name ?? '';
          const bName = b?.name ?? '';
          const aIsNvidia = /nvidia/i.test(aName);
          const bIsNvidia = /nvidia/i.test(bName);
          if(aIsNvidia === bIsNvidia) return 0;
          return aIsNvidia ? -1 : 1;
        });
        gpuList = prioritized;
        if(!gpuList.length){
          gpuIndex = 0;
        } else if(currentName){
          const matchIndex = gpuList.findIndex(g => g.name === currentName);
          gpuIndex = matchIndex >= 0 ? matchIndex : 0;
        } else {
          gpuIndex = 0;
        }
        renderGpuCard(true);
      } else if(!gpuList.length){
        renderGpuCard(true);
      }
      if(m.mem){
        const rawUsed = typeof m.mem.usedGB === 'number' && !Number.isNaN(m.mem.usedGB) ? m.mem.usedGB : null;
        const rawTotal = typeof m.mem.totalGB === 'number' && !Number.isNaN(m.mem.totalGB) ? m.mem.totalGB : null;
        const used = rawUsed != null ? Math.max(rawUsed, 0) : null;
        const total = rawTotal != null ? Math.max(rawTotal, 0) : null;
        const pct = total && used != null && total > 0 ? clamp((used / total) * 100, 0, 100) : null;

        setText('#mem-used', used != null ? used.toFixed(1) : '--');
        setText('#mem-total', total != null ? total.toFixed(1) : '--');
        memSpark.push(pct ?? 0);
        if(total != null && total > 0){
          totalMemoryGb = total;
        }

        if(memRingEl){
          if(pct != null){
            setRing(memRingEl, pct);
          } else {
            memRingEl.style.setProperty('--p', 0);
            const span = memRingEl.querySelector('span');
            if(span) span.textContent = '--';
          }
        }

        const speed = typeof m.mem.speedMhz === 'number' && !Number.isNaN(m.mem.speedMhz) ? m.mem.speedMhz : null;
        setText('#mem-speed', speed != null ? `${Math.round(speed)} MHz` : '-- MHz');

        const virtualTotal = typeof m.mem.virtualTotalGb === 'number' && !Number.isNaN(m.mem.virtualTotalGb) ? m.mem.virtualTotalGb : null;
        setText('#mem-virtual-total', virtualTotal != null ? `${virtualTotal.toFixed(1)} MB` : '-- MB');

        if(memPressureEl){
          let pressureLabel = '--';
          let pressureClass = null;
          if(pct != null){
            if(pct >= 90){
              pressureLabel = '告警';
              pressureClass = 'bad';
            } else if(pct >= 75){
              pressureLabel = '偏高';
              pressureClass = 'warn';
            } else {
              pressureLabel = '正常';
              pressureClass = 'good';
            }
          }
          memPressureEl.textContent = pressureLabel;
          if(memPressureChip){
            memPressureChip.classList.remove('good','warn','bad');
            if(pressureClass){
              memPressureChip.classList.add(pressureClass);
            }
          }
        }
      } else {
        setText('#mem-used', '--');
        setText('#mem-total', '--');
        memSpark.push(0);
        if(memRingEl){
          memRingEl.style.setProperty('--p', 0);
          const span = memRingEl.querySelector('span');
          if(span) span.textContent = '--';
        }
        setText('#mem-speed', '-- MHz');
        setText('#mem-virtual-total', '-- MB');
        if(memPressureEl){
          memPressureEl.textContent = '--';
        }
        if(memPressureChip){
          memPressureChip.classList.remove('good','warn','bad');
        }
      }

      if(m.net){
        netSummary = m.net;
      }
      if(Array.isArray(m.netAdapters)){
        const currentId = netList[netIndex]?.id ?? null;
        netList = m.netAdapters;
        if(!netList.length){
          netIndex = 0;
        } else if(currentId){
          const matchIndex = netList.findIndex(n => n.id === currentId);
          netIndex = matchIndex >= 0 ? matchIndex : 0;
        } else {
          netIndex = 0;
        }
        renderNetCard(true);
      } else if(m.net){
        netList = [];
        netIndex = 0;
        renderNetCard(true);
      }
      if(m.disk){
        const r = m.disk.readMBps ?? 0;
        const w = m.disk.writeMBps ?? 0;
        setText('#disk-r', r.toFixed(1));
        setText('#disk-w', w.toFixed(1));
        const total = r + w;
        diskSpark.push(total);
        // update extras
        if(diskTotalTextEl){ diskTotalTextEl.textContent = `${total.toFixed(1)} MB/s`; }
        if(diskRwRatioEl){
          if(total > 0){
            const rp = Math.round((r/total)*100);
            const wp = 100 - rp;
            diskRwRatioEl.textContent = `${rp}% / ${wp}%`;
          } else {
            diskRwRatioEl.textContent = '—';
          }
        }
        // maintain rolling peak
        diskHistory.push(total);
        if(diskHistory.length > diskHistoryCap) diskHistory.shift();
        const peak = Math.max(0, ...diskHistory);
        if(diskPeakTextEl){ diskPeakTextEl.textContent = `${peak.toFixed(1)} MB/s`; }
        // activity percent vs rolling peak
        const activity = peak > 0 ? clamp((total/peak)*100, 0, 100) : 0;
        if(diskActivityBar){ setMeter(diskActivityBar, activity); }
        if(diskActivityText){ diskActivityText.textContent = peak > 0 ? `${Math.round(activity)} %` : '— %'; }
      }

      if(m.foregroundApp){
        const app = m.foregroundApp;
        setTitleText(fgAppNameEl, app.windowTitle || app.processName || '—');
        setChipText(fgProcessNameEl, app.processName || '—');

        const cpuUsage = app.cpuUsagePercentage ?? null;
        if(cpuUsage != null){
          fgCpuTextEl.textContent = `${cpuUsage.toFixed(1)} %`;
          setMeter(fgCpuBar, clamp(cpuUsage, 0, 100));
          // no extra chips now
        } else {
          fgCpuTextEl.textContent = '— %';
          setMeter(fgCpuBar, 0);
        }

        const memoryMb = app.memoryUsageMb ?? null;
        if(memoryMb != null){
          const display = memoryMb >= 1024 ? `${(memoryMb/1024).toFixed(1)} GB` : `${memoryMb.toFixed(0)} MB`;
          fgMemTextEl.textContent = display;
          const denominatorMb = totalMemoryGb > 0 ? totalMemoryGb * 1024 : 8192;
          const memPct = clamp((memoryMb / denominatorMb) * 100, 0, 100);
          setMeter(fgMemBar, memPct);
          // no extra chips now
        } else {
          fgMemTextEl.textContent = '— MB';
          setMeter(fgMemBar, 0);
        }
      } else {
        setTitleText(fgAppNameEl, '—');
        setChipText(fgProcessNameEl, '—');
        fgCpuTextEl.textContent = '— %';
        fgMemTextEl.textContent = '— MB';
        setMeter(fgCpuBar, 0);
        setMeter(fgMemBar, 0);
      }

      if(Array.isArray(m.topForegroundApps)){
        renderTopForegroundApps(m.topForegroundApps);
      }

      // const alerts=[];
      // if(m.cpu?.temp>85) alerts.push(`CPU 温度过高：${m.cpu.temp.toFixed(0)}℃`);
      // const activeGpu = gpuList[gpuIndex];
      // if(activeGpu?.temp>85) alerts.push(`GPU 温度过高：${activeGpu.temp.toFixed(0)}℃`);

      // if(alerts.length){
      //   alertsPanel.classList.add('has-alerts');
      //   alertListEl.innerHTML = alerts
      //     .map(a=>`<div class="alert-chip">⚠️ ${a}</div>`)
      //     .join('');
      // }else{
      //   alertsPanel.classList.remove('has-alerts');
      //   alertListEl.innerHTML = `<div class="alert-empty">当前无告警</div>`;
      // }

      tempHighlights = Array.isArray(m.temperatureHighlights) ? m.temperatureHighlights : [];
      latestTemps = Array.isArray(m.temperatures) ? m.temperatures : [];

      renderTempList();
    }

    async function fetchMetrics(){
      try{
        const res = await fetch('/api/metrics', { cache: 'no-store' });
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const snapshot = await res.json();

        if(snapshot.machineName){
          const hostDetail = [snapshot.machineName, snapshot.osVersion, snapshot.motherboard].filter(Boolean).join(' · ');
          setText('#host', hostDetail);
        }

        if(snapshot.timestamp){
          const time = new Date(snapshot.timestamp);
          setText('#ver', `采集 ${time.toLocaleTimeString()}`);
        }

        const cpu = snapshot.cpu ?? {};
        const gpus = Array.isArray(snapshot.gpus) ? snapshot.gpus : [];
        const mem = snapshot.memory ?? {};
        const net = snapshot.network ?? {};
        const netAdapters = Array.isArray(snapshot.networkAdapters) ? snapshot.networkAdapters : [];
        const disk = snapshot.disk ?? {};
        const temps = Array.isArray(snapshot.temperatures) ? snapshot.temperatures : [];
        const tempHighlightsData = Array.isArray(snapshot.temperatureHighlights) ? snapshot.temperatureHighlights : [];

        window.updateMetrics({
          cpu: {
            name: snapshot.cpu?.name ?? null,
            usage: cpu.totalLoadPercentage ?? 0,
            temp: cpu.packageTemperatureC ?? null,
            clock: cpu.clockMhz ?? null
          },
          gpus: gpus.map(gpu => ({
            name: gpu.name ?? '',
            usage: gpu.loadPercentage ?? 0,
            temp: gpu.temperatureC ?? null,
            clock: gpu.coreClockMhz ?? null,
            memoryUsed: gpu.memoryUsedGb ?? null,
            memoryTotal: gpu.memoryTotalGb ?? null,
            memoryUsage: gpu.memoryUsagePercentage ?? null
          })),
          mem: {
            usedGB: mem.usedGb ?? null,
            totalGB: mem.totalGb ?? null,
            speedMhz: mem.speedMhz ?? null,
            virtualTotalGb: mem.virtualTotalGb ?? null
          },
          net: {
            upMBps: net.uploadMBps ?? 0,
            downMBps: net.downloadMBps ?? 0
          },
          netAdapters: netAdapters.map(adapter => ({
            id: adapter.identifier ?? '',
            name: adapter.name ?? '',
            upMBps: adapter.uploadMBps ?? null,
            downMBps: adapter.downloadMBps ?? null,
            linkSpeedMbps: adapter.linkSpeedMbps ?? null,
            connectionType: adapter.connectionType ?? null,
            ips: Array.isArray(adapter.ipAddresses) ? adapter.ipAddresses : []
          })),
          disk: {
            readMBps: disk.readMbps ?? 0,
            writeMBps: disk.writeMbps ?? 0
          },
          temperatures: temps,
          temperatureHighlights: tempHighlightsData,
          foregroundApp: snapshot.foregroundApp ?? null,
          topForegroundApps: Array.isArray(snapshot.topForegroundApps) ? snapshot.topForegroundApps : []
        });
      }catch(err){
        console.error('获取监控数据失败', err);
      }
    }

    setChipText(cpuNameChip, '—');
    setChipText(gpuNameChip, '—');
    setChipText(netNameChip, '—');
    renderTempHighlights();

    fetchMetrics();
    setInterval(fetchMetrics, 2000);
  </script>
</body>
</html>


